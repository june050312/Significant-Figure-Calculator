<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <style>
        body{
            background-color: #181818;
            color: white;
        }
    </style>
    <py-script>
        import decimal

        def getFloat(x):
            numList = list(x)
            flag = 0
            cnt = 0
            if int(float(x)) == 0:
                for i in numList:
                    if i != '0' and i != '.':
                        flag = 1
                    if flag:
                        cnt += 1
            else:
                for i in numList:
                    cnt += 1
                cnt -= 1
            return cnt

        def getSignificantFigure(x, y):
            len_x = getFloat(x)
            len_y = getFloat(y)
            if len_x < len_y:
                return len_x
            else:
                return len_y

        def getDecimal(x):
            numList = list(x)
            point = numList.index('.')
            return len(numList[point + 1:])

        def getDecimalAmount(x, y):
            len_x = getDecimal(x)
            len_y = getDecimal(y)
            if len_x < len_y:
                return len_x
            else:
                return len_y
            
        def calculate(a, b, op):
            significantFigure = getSignificantFigure(a, b)
            decimalAmount = getDecimalAmount(a, b)

            a, b = decimal.Decimal(a), decimal.Decimal(b)
            result = 0

            if op == '+' or op == '-':
                if op == '+':
                    result = a + b
                else:
                    result = a - b
                return float(round(result, decimalAmount))
            elif op == '*' or op == '/':
                if op == '*':
                    result = a * b
                else:
                    result = a / b
                return float(round(result, significantFigure - len(str(int(result)))))
            else:
                return 'Operand Error'
    </py-script>
    <script>
        window.onload = function() {
            console.log(pyscript.interpreter);
            setTimeout(() => {
                calculate = pyscript.interpreter.globals.get('calculate')
            }, 2000)
        };

        function getResult() {
            var a = document.getElementById("f-1").value;
            var b = document.getElementById("f-2").value;
            var op = document.getElementById("op").value;

            document.getElementById("result").innerText = calculate(a, b, op);
        };
    </script>
</head>
    <body>
        <div>
            <input type="text" id="f-1"> <input type="text" id="op"> <input type="text" id="f-2">
        </div>
        <input type="button" value="계산하기" onclick="getResult()">
        <div id="result">
            
        </div>
    </body>
</html>